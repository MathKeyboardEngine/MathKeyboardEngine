<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>

    <script type="module" type="text/javascript">
        import * as mke from '../../dist/MathKeyboardEngine.esm.js';
        import katex from 'https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.mjs';

        let latexConfiguration = new mke.LatexConfiguration();
        let keyboardMemory = new mke.KeyboardMemory();

        displayOutput();

        for (let i = 0; i < 10; i++) {
          registerAtomKey('digit' + i, (k, atom) => mke.Insert(k, atom), () => new mke.DigitAtom(i));
        }
        registerAtomKey('decimalSeparator', (k, atom) => mke.Insert(k, atom), () => new mke.DecimalSeparatorAtom())
        registerAtomKey('plus', (k, atom) => mke.Insert(k, atom), () => new mke.RawAtom("+"));
        registerAtomKey('minus', (k, atom) => mke.Insert(k, atom), () => new mke.RawAtom("-"));
        registerAtomKey('times', (k, atom) => mke.Insert(k, atom), () => new mke.RawAtom(String.raw`\times`));
        registerAtomKey('fraction', (k, atom) => mke.Insert(k, atom), () => new mke.FractionAtom());
        registerAtomKey('power', (k, powerAtom) => {
          if (!mke.TryInsertWithEncapsulateCurrent(k, powerAtom.Base)){
            mke.Insert(k, powerAtom);
          }
        }, () => new mke.PowerAtom());
        registerAtomKey('squareRoot', (k, atom) => mke.Insert(k, atom), () => new mke.SinglePlaceholderRawAtom(String.raw`\sqrt{`, '}'));
        registerAtomKey('nthRoot', (k, atom) => mke.Insert(k, atom), () => new mke.NthRootAtom());

        registerKey('moveLeft', (k) => mke.MoveLeft(k));
        registerKey('moveRight', (k) => mke.MoveRight(k));
        registerKey('moveUp', (k) => mke.MoveUp(k));
        registerKey('moveDown', (k) => mke.MoveDown(k));

        registerKey('deleteCurrent', (k) => mke.DeleteCurrent(k));

        function registerAtomKey(elementId, onclickArrowFuncForKeyboardMemoryAndAtom, atomGetter) {
          let element = document.getElementById(elementId);
          console.log(atomGetter());
          let latexToRenderOnKey = atomGetter().provideLatex(keyboardMemory, latexConfiguration);
          console.log(latexToRenderOnKey);
          katex.render(latexToRenderOnKey, element, { throwOnError: false });
          element.onclick = () => {
            onclickArrowFuncForKeyboardMemoryAndAtom(keyboardMemory, atomGetter());
            displayOutput();
          };
        }

        function registerKey(elementId, onclickArrowFuncForKeyboardMemory){
          let element = document.getElementById(elementId);
          element.onclick = () => {
            onclickArrowFuncForKeyboardMemory(keyboardMemory);
            displayOutput();
          };
        }

        function displayOutput(){
          katex.render(keyboardMemory.getLatex(latexConfiguration), document.getElementById('output'), { throwOnError: false });
        }
    </script>
    <script nomodule defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.js" integrity="sha384-GCPlQtWhtsjcfJYVuUlFZnpQgvoZ26GD/vvA4kG1PBaGBbtpq2cdvZjgj/mAMEY4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.css" integrity="sha384-SkMvsJ0Np/CalM0X1hZCccQs6tnLq178/sGoPANiauambU0V/bloCaG3wOXfv+Ef" crossorigin="anonymous">
    <style>
      #mathKeyboard > * {
        display: inline-block;
        border: 1px solid gray;
        padding: 5px;
      }
    </style>
  </head>
<body>
  <h1>Example (ugly draft!)</h1>
<div id="output" style="border:1px solid black;"></div>
<br/>
<div id="mathKeyboard">
  <div id="digit0"></div>
  <div id="digit1"></div>
  <div id="digit2"></div>
  <div id="digit3"></div>
  <div id="digit4"></div>
  <div id="digit5"></div>
  <div id="digit6"></div>
  <div id="digit7"></div>
  <div id="digit8"></div>
  <div id="digit9"></div>
  <div id="decimalSeparator"></div>
  <br/>
  <div id="plus"></div>
  <div id="minus"></div>
  <div id="times"></div>
  <div id="fraction"></div>
  <div id="power"></div>
  <div id="squareRoot"></div>
  <div id="nthRoot"></div>
  <br/>
  <div id="moveLeft">left</div>
  <div id="moveRight">right</div>
  <div id="moveDown">down</div>
  <div id="moveUp">up</div>
  <br/>
  <div id="deleteCurrent">delete</div>

</div>
</body>
</html> 