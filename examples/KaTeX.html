<!DOCTYPE html>
<meta charset="UTF-8" />
<html>
  <head>
    <!-- KaTeX specific code START -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.css"
      integrity="sha384-SkMvsJ0Np/CalM0X1hZCccQs6tnLq178/sGoPANiauambU0V/bloCaG3wOXfv+Ef"
      crossorigin="anonymous"
    />
    <!-- KaTeX specific code END -->
    <script type="module" type="text/javascript">
      // KaTeX specific code START
      import katex from 'https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.mjs';
      // KaTeX specific code END
      import * as mke from '../../dist/MathKeyboardEngine.es2020-esm.js';
      let latexConfiguration = new mke.LatexConfiguration();
      let keyboardMemory = new mke.KeyboardMemory();
      const supportsSelectionMode = 'supportsSelectionMode';

      // === KaTeX specific code START ===
      latexConfiguration.selectionHightlightStart = String.raw`\colorbox{#ADD8E6}{\(`;
      latexConfiguration.selectionHightlightEnd = String.raw`\)}`;
      // === KaTeX specific code END ===

      displayResult();

      for (let i = 0; i < 10; i++) {
        registerNodeKey('digit' + i, () => new mke.DigitNode(i.toString()));
      }

      for (let letter of ['a', 'b', 'c', 'x', 'y', 'z']) {
        registerNodeKey(letter, () => new mke.StandardLeafNode(letter));
      }

      for (let s of ['alpha', 'beta', 'gamma', 'lambda', 'mu', 'pi', 'div', 'sin', 'tan', 'cos', 'arcsin', 'arccos', 'arctan', 'infty', 'leftarrow', 'rightarrow', 'uparrow', 'downarrow', 'approx']) {
        registerNodeKey(s, () => new mke.StandardLeafNode('\\' + s + ' '));
      }

      registerNodeKey('decimalSeparator', () => new mke.DecimalSeparatorNode());

      registerNodeKey('equal', () => new mke.StandardLeafNode('='));
      registerNodeKey('notEqual', () => new mke.StandardLeafNode(String.raw`\neq `));

      registerNodeKey('lessThan', () => new mke.StandardLeafNode('<'));
      registerNodeKey('greaterThan', () => new mke.StandardLeafNode('>'));
      registerNodeKey('lessThanOrEqual', () => new mke.StandardLeafNode(String.raw`\leq `));
      registerNodeKey('greaterThanOrEqual', () => new mke.StandardLeafNode(String.raw`\geq `));

      registerNodeKey('plus', () => new mke.StandardLeafNode('+'));
      registerNodeKey('minus', () => new mke.StandardLeafNode('-'));
      registerNodeKey('times', () => new mke.StandardLeafNode(String.raw`\times `));
      registerNodeKey('ratio', () => new mke.StandardLeafNode(':'));
      registerNodeKey('faculty', () => new mke.StandardLeafNode('!'));

      registerNodeKey('fraction', () => new mke.DescendingBranchingNode(String.raw`\frac{`, '}{', '}'), mke.Insert, mke.InsertWithEncapsulateSelection);
      registerNodeKey('binomial', () => new mke.DescendingBranchingNode(String.raw`\binom{`, '}{', '}'), mke.Insert, mke.InsertWithEncapsulateSelection);

      registerNodeKey('power', () => new mke.AscendingBranchingNode('{', '}^{', '}'), mke.InsertWithEncapsulateCurrent, mke.InsertWithEncapsulateSelectionAndPrevious);

      registerNodeKey('subscript', () => new mke.DescendingBranchingNode('{', '}_{', '}'), mke.InsertWithEncapsulateCurrent, mke.InsertWithEncapsulateSelectionAndPrevious);

      registerNodeKey('squareRoot', () => new mke.StandardBranchingNode(String.raw`\sqrt{`, '}'), mke.Insert, mke.InsertWithEncapsulateSelection);
      registerNodeKey('nthRoot', () => new mke.DescendingBranchingNode(String.raw`\sqrt[`, ']{', '}'));

      registerNodeKey('roundBrackets', () => new mke.RoundBracketsNode(), mke.Insert, mke.InsertWithEncapsulateSelection);
      registerNodeKey('squareBrackets', () => new mke.StandardBranchingNode(String.raw`\left[`, String.raw`\right]`), mke.Insert, mke.InsertWithEncapsulateSelection);
      registerNodeKey('pipes', () => new mke.StandardBranchingNode(String.raw`\left|`, String.raw`\right|`), mke.Insert, mke.InsertWithEncapsulateSelection);
      registerNodeKey('doublePipes', () => new mke.StandardBranchingNode(String.raw`\left\|`, String.raw`\right\|`), mke.Insert, mke.InsertWithEncapsulateSelection);
      registerNodeKey('curlyBrackets', () => new mke.StandardBranchingNode(String.raw`\left\{`, String.raw`\right\}`), mke.Insert, mke.InsertWithEncapsulateSelection);

      registerNodeKey('naturalNumbers', () => new mke.StandardLeafNode(String.raw`\mathbb{N}`));
      registerNodeKey('integers', () => new mke.StandardLeafNode(String.raw`\mathbb{Z}`));
      registerNodeKey('realNumbers', () => new mke.StandardLeafNode(String.raw`\mathbb{R}`));

      registerNodeKey('isMemberOf', () => new mke.StandardLeafNode(String.raw`\in `));
      registerNodeKey('isProperSubsetOf', () => new mke.StandardLeafNode(String.raw`\subset `));
      registerNodeKey('isSubsetOf', () => new mke.StandardLeafNode(String.raw`\subseteq `));
      registerNodeKey('setDifference', () => new mke.StandardLeafNode(String.raw`\setminus `));
      registerNodeKey('exists', () => new mke.StandardLeafNode(String.raw`\exists `));
      registerNodeKey('existsOne', () => new mke.StandardLeafNode(String.raw`\exists! `));
      registerNodeKey('forAll', () => new mke.StandardLeafNode(String.raw`\forall `));
      registerNodeKey('not', () => new mke.StandardLeafNode(String.raw`\neg `));
      registerNodeKey('or', () => new mke.StandardLeafNode(String.raw`\lor `));
      registerNodeKey('and', () => new mke.StandardLeafNode(String.raw`\land `));
      registerNodeKey('doubleRightArrow', () => new mke.StandardLeafNode(String.raw`\Rightarrow `));
      registerNodeKey('doubleLeftArrow', () => new mke.StandardLeafNode(String.raw`\Leftarrow `));

      registerNodeKey('sin-1', () => new mke.StandardLeafNode(String.raw`\sin^{-1}`));
      registerNodeKey('cos-1', () => new mke.StandardLeafNode(String.raw`\cos^{-1}`));
      registerNodeKey('tan-1', () => new mke.StandardLeafNode(String.raw`\tan^{-1}`));
      registerNodeKey('sininv', () => new mke.StandardLeafNode(String.raw`\sin^{inv}`));
      registerNodeKey('cosinv', () => new mke.StandardLeafNode(String.raw`\cos^{inv}`));
      registerNodeKey('taninv', () => new mke.StandardLeafNode(String.raw`\tan^{inv}`));

      registerNodeKey('integral', () => new mke.AscendingBranchingNode(String.raw`\int_{`, '}^{', '}'));
      registerNodeKey('sum', () => new mke.AscendingBranchingNode(String.raw`\sum_{`, '}^{', '}'));
      registerNodeKey('product', () => new mke.AscendingBranchingNode(String.raw`\prod_{`, '}^{', '}'));
      registerNodeKey('limit', () => new mke.StandardBranchingNode(String.raw`\lim_{`, '}'));

      const matrixWidthInputElement = document.getElementById('matrixWidth');
      const matrixHeightInputElement = document.getElementById('matrixHeight');
      function ReRegisterMatrix() {
        registerNodeKey('pmatrix', () => new mke.MatrixNode('pmatrix', matrixWidthInputElement.value, matrixHeightInputElement.value));
        registerNodeKey('vmatrix', () => new mke.MatrixNode('vmatrix', matrixWidthInputElement.value, matrixHeightInputElement.value));
      }
      ReRegisterMatrix();
      matrixWidthInputElement.onchange = ReRegisterMatrix;
      matrixHeightInputElement.onchange = ReRegisterMatrix;

      registerKey('moveLeft', mke.MoveLeft, mke.SelectLeft, false);
      registerKey('moveRight', mke.MoveRight, mke.SelectRight, false);
      registerKey('moveUp', mke.MoveUp);
      registerKey('moveDown', mke.MoveDown);

      registerKey('deleteCurrent', mke.DeleteCurrent, mke.DeleteSelection);

      registerKey('selectionModeToggle', (k) => {
        if (mke.InSelectionMode(k)) {
          MyLeaveSelectionMode(k);
        } else {
          MyEnterSelectionMode(k);
        }
      });

      function MyLeaveSelectionMode(k) {
        mke.LeaveSelectionMode(k);
        let elements = document.getElementsByClassName(supportsSelectionMode);
        for (let element of elements) {
          element.classList.remove('inSelectionMode');
        }
      }
      function MyEnterSelectionMode(k) {
        mke.EnterSelectionMode(k);
        let elements = document.getElementsByClassName(supportsSelectionMode);
        for (let element of elements) {
          element.classList.add('inSelectionMode');
        }
      }

      function registerNodeKey(elementId, nodeGetter, onclickFuncForKeyboardMemoryAndNode = mke.Insert, onclickSelectionModeArrowFuncForKeyboardMemoryAndNode = null) {
        let element = document.getElementById(elementId);
        if (onclickSelectionModeArrowFuncForKeyboardMemoryAndNode != null) {
          element.classList.add(supportsSelectionMode);
        }

        let latex = mke.GetViewModeLatex(nodeGetter(), latexConfiguration);
        renderLatexInKey(latex, element);
        element.onclick = () => {
          if (mke.InSelectionMode(keyboardMemory)) {
            if (onclickSelectionModeArrowFuncForKeyboardMemoryAndNode != null) {
              onclickSelectionModeArrowFuncForKeyboardMemoryAndNode(keyboardMemory, nodeGetter());
            }
            MyLeaveSelectionMode(keyboardMemory);
          } else {
            onclickFuncForKeyboardMemoryAndNode(keyboardMemory, nodeGetter());
          }
          displayResult();
        };
      }

      function registerKey(elementId, onclickArrowFuncForKeyboardMemory, onclickSelectionModeFuncForKeyboardMemory = null, leaveSelectionMode = true) {
        let element = document.getElementById(elementId);
        if (onclickSelectionModeFuncForKeyboardMemory != null) {
          element.classList.add(supportsSelectionMode);
        }

        element.onclick = () => {
          if (mke.InSelectionMode(keyboardMemory)) {
            if (onclickSelectionModeFuncForKeyboardMemory != null) {
              onclickSelectionModeFuncForKeyboardMemory(keyboardMemory);
            }
            if (leaveSelectionMode) {
              MyLeaveSelectionMode(keyboardMemory);
            }
          } else {
            onclickArrowFuncForKeyboardMemory(keyboardMemory);
          }
          displayResult();
        };
      }

      function displayResult() {
        let editModeLatex = mke.GetEditModeLatex(keyboardMemory, latexConfiguration);
        renderLatexInOutputBox(editModeLatex, document.getElementById('renderedEditModeLatex'));

        let viewModeLatex = mke.GetViewModeLatex(keyboardMemory, latexConfiguration);
        document.getElementById('viewModeLatex').innerText = viewModeLatex;
      }

      // === KaTeX specific code START ===
      function renderLatexInKey(latex, element) {
        katex.render(latex, element, { throwOnError: false });
      }

      function renderLatexInOutputBox(latex, element) {
        katex.render(latex, element, {
          displayMode: true,
          throwOnError: false,
        });
      }
      // === KaTeX specific code END ===
    </script>
    <style>
      #renderedEditModeLatex {
        border: 1px solid gray;
        padding: 5px;
      }
      #viewModeLatex {
        text-align: right;
      }
      #mathKeyboard > * {
        display: inline-block;
        vertical-align: top;
        border: 1px solid gray;
        padding: 5px;
        margin: 2px;
        cursor: default;
      }

      .arrow-up {
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 10px solid black;
      }
      .arrow-down {
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 10px solid black;
      }
      .arrow-right {
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-left: 10px solid black;
      }
      .arrow-left {
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-right: 10px solid black;
      }
      .inSelectionMode {
        background-color: #add8e6;
      }
      #selectionModeToggle {
        background-color: #add8e6;
        width: 15px;
        height: 15px;
      }
    </style>
  </head>
  <body>
    <h1>MathKeyboardEngine + KaTeX</h1>
    <h3>Example keys - to be styled - to help you design your virtual math keyboard</h3>
    <div id="renderedEditModeLatex"></div>
    <div id="viewModeLatex"></div>
    <br />
    <div id="mathKeyboard">
      <div id="moveLeft"><div class="arrow-left"></div></div>
      <div id="moveRight"><div class="arrow-right"></div></div>
      <div id="moveDown"><div class="arrow-down"></div></div>
      <div id="moveUp"><div class="arrow-up"></div></div>
      <div id="selectionModeToggle"></div>
      <div id="deleteCurrent">&#128293;</div>
      <br />
      <div id="digit0"></div>
      <div id="digit1"></div>
      <div id="digit2"></div>
      <div id="digit3"></div>
      <div id="digit4"></div>
      <div id="digit5"></div>
      <div id="digit6"></div>
      <div id="digit7"></div>
      <div id="digit8"></div>
      <div id="digit9"></div>
      <div id="decimalSeparator"></div>
      <br />
      <div id="a"></div>
      <div id="b"></div>
      <div id="c"></div>
      <div id="x"></div>
      <div id="y"></div>
      <div id="z"></div>
      <div id="alpha"></div>
      <div id="beta"></div>
      <div id="gamma"></div>
      <div id="lambda"></div>
      <div id="mu"></div>
      <div id="pi"></div>
      <br />
      <div id="plus"></div>
      <div id="minus"></div>
      <div id="times"></div>
      <div id="ratio"></div>
      <div id="div"></div>
      <div id="faculty"></div>
      <br />
      <div id="binomial"></div>
      <div id="fraction"></div>
      <div id="power"></div>
      <div id="subscript"></div>
      <div id="squareRoot"></div>
      <div id="nthRoot"></div>
      <br />
      <div id="roundBrackets"></div>
      <div id="squareBrackets"></div>
      <div id="curlyBrackets"></div>
      <div id="pipes"></div>
      <div id="doublePipes"></div>
      <br />
      <div style="text-align: right">
        <label for="matrixHeight">Height</label>
        <input id="matrixHeight" type="number" value="2" min="1" style="width: 50px" />
        <br />
        <label for="matrixWidth">Width</label>
        <input id="matrixWidth" type="number" value="2" min="1" style="width: 50px" />
      </div>
      <div id="pmatrix"></div>
      <div id="vmatrix"></div>
      <br />
      <div id="approx"></div>
      <div id="equal"></div>
      <div id="notEqual"></div>
      <div id="lessThanOrEqual"></div>
      <div id="greaterThanOrEqual"></div>
      <div id="lessThan"></div>
      <div id="greaterThan"></div>
      <br />
      <div id="naturalNumbers"></div>
      <div id="integers"></div>
      <div id="realNumbers"></div>

      <div id="isMemberOf"></div>
      <div id="isProperSubsetOf"></div>
      <div id="isSubsetOf"></div>
      <div id="setDifference"></div>
      <div id="exists"></div>
      <div id="existsOne"></div>
      <div id="forAll"></div>
      <div id="not"></div>
      <div id="or"></div>
      <div id="and"></div>
      <div id="doubleRightArrow"></div>
      <div id="doubleLeftArrow"></div>
      <br />
      <div id="sin"></div>
      <div id="cos"></div>
      <div id="tan"></div>
      <div id="arcsin"></div>
      <div id="arccos"></div>
      <div id="arctan"></div>
      <div id="sin-1"></div>
      <div id="cos-1"></div>
      <div id="tan-1"></div>
      <div id="sininv"></div>
      <div id="cosinv"></div>
      <div id="taninv"></div>
      <br />
      <div id="integral"></div>
      <div id="sum"></div>
      <div id="product"></div>
      <div id="limit"></div>
      <div id="leftarrow"></div>
      <div id="rightarrow"></div>
      <div id="uparrow"></div>
      <div id="downarrow"></div>
      <div id="infty"></div>
    </div>
  </body>
</html>
