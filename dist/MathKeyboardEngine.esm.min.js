function E(e,t){return e.SyntaxTreeRoot.getLatex(e,t)}var l=class{constructor(){this.ParentAtom=null;this.Atoms=[]}getLatex(t,r){return t.InclusiveSelectionLeftBorder===this?r.selectionHightlightStart+this.Atoms.map(o=>o.getLatex(t,r)).join(""):this===t.Current?this.Atoms.length==0?r.activePlaceholderLatex:r.activePlaceholderLatex+this.Atoms.map(o=>o.getLatex(t,r)).join(""):this.Atoms.length==0?r.passivePlaceholderLatex:this.Atoms.map(o=>o.getLatex(t,r)).join("")}};var x=class{constructor(){this.SyntaxTreeRoot=new l;this.Current=this.SyntaxTreeRoot;this.SelectionDiff=null;this.InclusiveSelectionRightBorder=null;this.InclusiveSelectionLeftBorder=null}};var N=new x;function G(e,t){return(e instanceof x?e.SyntaxTreeRoot:e).getLatex(N,t)}function T(e,t){let r=!1;for(let o=e.length-1;o>=0;o--){let n=e[o];if(!r){n===t&&(r=!0);continue}if(n.Atoms.length>0)return n}return null}function h(e){return e.length==0?null:e[e.length-1]}function c(e,t){let r=e.indexOf(t);return r>0?e[r-1]:null}function p(e,t){let r=e.indexOf(t);e.splice(r,1)}var m=class{getLatex(t,r){let o=this.getLatexPart(t,r);return t.SelectionDiff!=null&&t.SelectionDiff!=0?(t.InclusiveSelectionLeftBorder===this&&(o=r.selectionHightlightStart+o),t.InclusiveSelectionRightBorder===this&&(o=o+r.selectionHightlightEnd),o):t.Current===this?o+r.activePlaceholderLatex:o}};var a=class extends m{constructor(t){super();this.Placeholders=t,this.Placeholders.forEach(r=>{r.ParentAtom=this})}GetMoveDownSuggestion(t){return null}GetMoveUpSuggestion(t){return null}};function u(e){return e[e.length-1]}var P=class extends m{};var d=class extends P{};function y(e,t){let r=e.indexOf(t);return r!=-1&&r<e.length-1?e[r+1]:null}var b=class extends a{constructor(t,r){super([new l]);this.Prefix=t,this.Content=this.Placeholders[0],this.Suffix=r}getLatexPart(t,r){return this.Prefix+this.Content.getLatex(t,r)+this.Suffix}};var S=class extends b{constructor(t=String.raw`\left(`,r=String.raw`\right)`){super(t,r)}};function f(e){var t;if(e.Current instanceof l)if(e.Current.Atoms.length>0){let r=e.Current.Atoms[0];e.Current=r instanceof a?r.Placeholders[0]:r}else{if(e.Current.ParentAtom==null)return;e.Current=(t=y(e.Current.ParentAtom.Placeholders,e.Current))!=null?t:e.Current.ParentAtom}else{let r=y(e.Current.ParentPlaceholder.Atoms,e.Current);if(r!=null)r instanceof a?e.Current=r.Placeholders[0]:e.Current=r;else{let o=e.Current.ParentPlaceholder.ParentAtom;if(o!=null){let n=y(o.Placeholders,e.Current.ParentPlaceholder);e.Current=n!=null?n:o}}}}function F(e,t,r){var n;let o=t.Placeholders[0];if(e.Current instanceof m){let i=e.Current.ParentPlaceholder.Atoms,s=i.indexOf(e.Current);if(i[s]=t,t.ParentPlaceholder=e.Current.ParentPlaceholder,e.Current instanceof S&&(r==null?void 0:r.deleteOuterRoundBracketsIfAny)){let C=e.Current.Content;for(let K of C.Atoms)K.ParentPlaceholder=o,o.Atoms.push(K),e.Current=(n=y(t.Placeholders,o))!=null?n:t}else e.Current instanceof d?(o.Atoms.push(e.Current),e.Current.ParentPlaceholder=o,L(s,i,o),f(e)):(o.Atoms.push(e.Current),e.Current.ParentPlaceholder=o,f(e));return!0}else return!1}function L(e,t,r){for(let o=e-1;o>=0;o--){let n=t[o];if(n instanceof d)p(t,n),r.Atoms.unshift(n),n.ParentPlaceholder=r;else break}}function U(e){var t;if(e.Current instanceof l){if(e.Current.ParentAtom==null||e.Current.Atoms.length>0)return;{let r=T(e.Current.ParentAtom.Placeholders,e.Current);if(r)if(e.Current.ParentAtom.Placeholders.length==2&&e.Current===e.Current.ParentAtom.Placeholders[1]&&e.Current.Atoms.length==0){e.Current.ParentAtom.ParentPlaceholder.Atoms.pop();for(let o of r.Atoms)e.Current.ParentAtom.ParentPlaceholder.Atoms.push(o),o.ParentPlaceholder=e.Current.ParentAtom.ParentPlaceholder;e.Current=u(r.Atoms)}else r.Atoms.pop(),e.Current=(t=h(r.Atoms))!=null?t:r;else if(e.Current.ParentAtom.Placeholders.every(o=>o.Atoms.length==0)){let o=e.Current.ParentAtom.ParentPlaceholder,n=c(o.Atoms,e.Current.ParentAtom);p(o.Atoms,e.Current.ParentAtom),e.Current=n!=null?n:o}else e.Current.ParentAtom.Placeholders[0]===e.Current&&e.Current.Atoms.length==0&&e.Current.ParentAtom.Placeholders.some(o=>o.Atoms.length!=0)&&j(e.Current)&&(e.Current=u(e.Current.Atoms))}}else if(e.Current instanceof a&&e.Current.Placeholders.some(r=>r.Atoms.length>0)){let r;for(let o=e.Current.Placeholders.length-1;o>=0;o--){let n=e.Current.Placeholders[o];if(n.Atoms.length>0){r=n;break}}r.Atoms.pop(),e.Current=r.Atoms.length==0?r:u(r.Atoms)}else{let r=c(e.Current.ParentPlaceholder.Atoms,e.Current);p(e.Current.ParentPlaceholder.Atoms,e.Current),e.Current=r!=null?r:e.Current.ParentPlaceholder}}function j(e){let t=c(e.ParentAtom.ParentPlaceholder.Atoms,e.ParentAtom);return t!=null?(p(e.ParentAtom.ParentPlaceholder.Atoms,t),e.Atoms.push(t),t.ParentPlaceholder=e,t instanceof d&&L(t.ParentPlaceholder.Atoms.length,t.ParentPlaceholder.Atoms,e),!0):!1}function g(e){e.SelectionDiff=null,e.InclusiveSelectionRightBorder=null,e.InclusiveSelectionLeftBorder=null}function M(e,t){var n;if(e.SelectionDiff==null)throw"Turn on selection mode before calling this method.";if(e.SelectionDiff==0)return g(e),[];let r=e.SelectionDiff,o=t==null?[]:[t.andInsert];if(e.Current instanceof l)return g(e),e.Current.Atoms.splice(0,r,...o);{let i=e.Current.ParentPlaceholder.Atoms,s=i.indexOf(e.InclusiveSelectionLeftBorder);return e.Current=(n=c(i,e.InclusiveSelectionLeftBorder))!=null?n:e.Current.ParentPlaceholder,g(e),i.splice(s,$(r),...o)}}function $(e){return e<0?-e:e}function H(e){M(e)}function _(e,t){if(e.Current instanceof l)e.Current.Atoms.unshift(t),t.ParentPlaceholder=e.Current;else{let r=e.Current.ParentPlaceholder,o=r.Atoms.indexOf(e.Current);r.Atoms.splice(o+1,0,t),t.ParentPlaceholder=r}f(e)}function V(e,t){let r=M(e,{andInsert:t});if(r.length==0)return!1;{let o=t.Placeholders[0];for(let n of r)n.ParentPlaceholder=o,o.Atoms.push(n);return e.Current=u(r),f(e),!0}}function q(e){var o;let t=e.Current instanceof l?e.Current:e.Current.ParentPlaceholder,r;for(;;){if(t.ParentAtom==null)return;if(r=t.ParentAtom,r instanceof a){let n=r.GetMoveDownSuggestion(t);if(n!=null){e.Current=(o=h(n.Atoms))!=null?o:n;return}}t=r.ParentPlaceholder}}function z(e){var t,r;if(e.Current instanceof l){if(e.Current.ParentAtom==null)return;let o=c(e.Current.ParentAtom.Placeholders,e.Current);if(o!==null)o.Atoms.length==0?e.Current=o:e.Current=u(o.Atoms);else{let n=e.Current.ParentAtom.ParentPlaceholder,i=c(n.Atoms,e.Current.ParentAtom);i!=null?e.Current=i:e.Current=n}}else if(e.Current instanceof a){let o=u(e.Current.Placeholders);e.Current=(t=u(o.Atoms))!=null?t:o}else e.Current=(r=c(e.Current.ParentPlaceholder.Atoms,e.Current))!=null?r:e.Current.ParentPlaceholder}function J(e){var o;let t=e.Current instanceof l?e.Current:e.Current.ParentPlaceholder,r;for(;;){if(t.ParentAtom==null)return;if(r=t.ParentAtom,r instanceof a){let n=r.GetMoveUpSuggestion(t);if(n!=null){e.Current=(o=h(n.Atoms))!=null?o:n;return}}t=r.ParentPlaceholder}}function v(e,t){if(e.SelectionDiff=t,t==0){e.InclusiveSelectionLeftBorder=null,e.InclusiveSelectionRightBorder=null;return}if(e.Current instanceof l)e.InclusiveSelectionLeftBorder=e.Current,e.InclusiveSelectionRightBorder=e.Current.Atoms[t-1];else{let r=e.Current.ParentPlaceholder.Atoms,o=r.indexOf(e.Current);if(t>0)e.InclusiveSelectionLeftBorder=r[o+1],e.InclusiveSelectionRightBorder=r[o+t];else if(t<0){let n=o+t+1;n<0?e.InclusiveSelectionLeftBorder=e.Current.ParentPlaceholder:e.InclusiveSelectionLeftBorder=r[n],e.InclusiveSelectionRightBorder=e.Current}}}function Q(e){var r;let t=(r=e.SelectionDiff)!=null?r:0;e.Current instanceof m&&e.Current.ParentPlaceholder.Atoms.indexOf(e.Current)+t>=0&&v(e,t-1)}function X(e){var r;let t=(r=e.SelectionDiff)!=null?r:0;(e.Current instanceof l&&t<e.Current.Atoms.length||e.Current instanceof m&&e.Current.ParentPlaceholder.Atoms.indexOf(e.Current)+t<e.Current.ParentPlaceholder.Atoms.length)&&v(e,t+1)}var B=class extends d{getLatexPart(t,r){return r.decimalSeparator}};var R=class extends d{constructor(t){super();this.value=t}getLatexPart(t,r){return this.value.toString()}};var O=class extends P{constructor(t){super();this.Latex=t}getLatexPart(t,r){return this.Latex}};var w=class extends a{constructor(t){let r=[],o=[];for(let n=0;n<t.height;n++){let i=[];for(let s=0;s<t.width;s++){let C=new l;i.push(C),o.push(C)}r.push(i)}super(o);for(let n of o)n.ParentAtom=this;this.Grid=r,this.MatrixType=t.matrixType}getLatexPart(t,r){let o=String.raw`\begin{${this.MatrixType}}`;return o+=this.Grid.map(n=>n.map(i=>i.getLatex(t,r)).join(" & ")).join(String.raw` \\ `),o+=String.raw`\end{${this.MatrixType}}`,o}GetMoveDownSuggestion(t){let{rowNumber:r,indexInRow:o}=this.GetPositionOf(t);return r+1<this.Grid.length?this.Grid[r+1][o]:null}GetMoveUpSuggestion(t){let{rowNumber:r,indexInRow:o}=this.GetPositionOf(t);return r-1>=0?this.Grid[r-1][o]:null}GetPositionOf(t){for(let r=0;r<this.Grid.length;r++){let o=this.Grid[r];for(let n=0;n<o.length;n++)if(o[n]===t)return{rowNumber:r,indexInRow:n}}throw"The provided placeholder is not part of the Grid."}};var A=class extends a{constructor(t,r,o){let n=typeof r=="string"?2:r.length+1,i=new Array;for(let s=0;s<n;s++)i.push(new l);super(i);this.before=t,this.between=typeof r=="string"?[r]:r,this.after=o}getLatexPart(t,r){let o=this.before;for(let n=0;n<this.between.length;n++)o+=this.Placeholders[0].getLatex(t,r),o+=this.between[0];return o+=this.Placeholders[this.Placeholders.length-1].getLatex(t,r),o+=this.after,o}};var D=class extends A{GetMoveDownSuggestion(t){let r=this.Placeholders.indexOf(t);return r>0?this.Placeholders[r-1]:null}GetMoveUpSuggestion(t){let r=this.Placeholders.indexOf(t);return r<this.Placeholders.length-1?this.Placeholders[r+1]:null}};var I=class extends A{GetMoveDownSuggestion(t){let r=this.Placeholders.indexOf(t);return r<this.Placeholders.length-1?this.Placeholders[r+1]:null}GetMoveUpSuggestion(t){let r=this.Placeholders.indexOf(t);return r>0?this.Placeholders[r-1]:null}};var W=class{constructor(){this.activePlaceholderNucleus=String.raw`\blacksquare `;this.passivePlaceholderNucleus=String.raw`\square `;this.decimalSeparator=".";this.selectionHightlightStart=String.raw`\colorbox{#ADD8E6}{`;this.selectionHightlightEnd="}"}get activePlaceholderLatex(){return this.activePlaceholderColor==null?this.activePlaceholderNucleus:String.raw`\color{${this.activePlaceholderColor}}{${this.activePlaceholderNucleus}}`}get passivePlaceholderLatex(){return this.passivePlaceholderColor==null?this.passivePlaceholderNucleus:String.raw`\color{${this.passivePlaceholderColor}}{${this.passivePlaceholderNucleus}}`}};export{m as Atom,B as DecimalSeparatorAtom,U as DeleteCurrent,H as DeleteSelection,R as DigitAtom,E as GetEditModeLatex,G as GetViewModeLatex,_ as Insert,x as KeyboardMemory,W as LatexConfiguration,g as LeaveSelectionMode,w as MatrixAtom,q as MoveDown,z as MoveLeft,f as MoveRight,J as MoveUp,D as MultiplePlaceholdersAscendingRawAtom,I as MultiplePlaceholdersDescendingRawAtom,A as MultiplePlaceholdersRawAtom,l as Placeholder,O as RawAtom,P as ReadonlyAtom,S as RoundBracketsAtom,Q as SelectLeft,X as SelectRight,b as SinglePlaceholderRawAtom,F as TryInsertWithEncapsulateCurrent,V as TryInsertWithEncapsulateSelection,a as WritableAtom};
